"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const cors = require("cors");
const express = require("express");
const PORT = 8088;
const script_init_1 = require("./scripts/script-init");
(0, script_init_1.initAdmin)();
const health_1 = require("./health");
const transact_1 = require("./transact");
const change_user_info_1 = require("./change-user-info");
const create_user_1 = require("./create-user");
const create_answer_1 = require("./create-answer");
const swap_cert_1 = require("./swap-cert");
const dividend_cert_1 = require("./dividend-cert");
const place_bet_1 = require("./place-bet");
const cancel_bet_1 = require("./cancel-bet");
const sell_bet_1 = require("./sell-bet");
const sell_shares_1 = require("./sell-shares");
const add_subsidy_1 = require("./add-subsidy");
const claim_manalink_1 = require("./claim-manalink");
const create_market_1 = require("./create-market");
const create_comment_1 = require("./create-comment");
const create_group_1 = require("./create-group");
const resolve_market_1 = require("./resolve-market");
const unsubscribe_1 = require("./unsubscribe");
const stripe_1 = require("./stripe");
const get_current_user_1 = require("./get-current-user");
const create_post_1 = require("./create-post");
const save_twitch_credentials_1 = require("./save-twitch-credentials");
const test_scheduled_function_1 = require("./test-scheduled-function");
const validate_iap_1 = require("functions/src/validate-iap");
const mark_all_notifications_1 = require("functions/src/mark-all-notifications");
const claim_destiny_sub_1 = require("functions/src/claim-destiny-sub");
const update_group_member_role_1 = require("functions/src/update-group-member-role");
const add_contract_to_group_1 = require("./add-contract-to-group");
const remove_contract_from_group_1 = require("./remove-contract-from-group");
const app = express();
const addEndpointRoute = (path, endpoint, ...middlewares) => {
    const method = endpoint.opts.method.toLowerCase();
    const corsMiddleware = cors({ origin: endpoint.opts.cors });
    const allMiddleware = [...middlewares, corsMiddleware];
    app.options(path, corsMiddleware); // preflight requests
    app[method](path, ...allMiddleware, endpoint.handler);
};
const addJsonEndpointRoute = (name, endpoint) => {
    addEndpointRoute(name, endpoint, express.json());
};
addEndpointRoute('/health', health_1.health);
addJsonEndpointRoute('/transact', transact_1.transact);
addJsonEndpointRoute('/changeuserinfo', change_user_info_1.changeuserinfo);
addJsonEndpointRoute('/createuser', create_user_1.createuser);
addJsonEndpointRoute('/createanswer', create_answer_1.createanswer);
addJsonEndpointRoute('/createcomment', create_comment_1.createcomment);
addJsonEndpointRoute('/swapcert', swap_cert_1.swapcert);
addJsonEndpointRoute('/dividendcert', dividend_cert_1.dividendcert);
addJsonEndpointRoute('/placebet', place_bet_1.placebet);
addJsonEndpointRoute('/cancelbet', cancel_bet_1.cancelbet);
addJsonEndpointRoute('/sellbet', sell_bet_1.sellbet);
addJsonEndpointRoute('/sellshares', sell_shares_1.sellshares);
addJsonEndpointRoute('/addsubsidy', add_subsidy_1.addsubsidy);
addJsonEndpointRoute('/claimmanalink', claim_manalink_1.claimmanalink);
addJsonEndpointRoute('/createmarket', create_market_1.createmarket);
addJsonEndpointRoute('/creategroup', create_group_1.creategroup);
addJsonEndpointRoute('/resolvemarket', resolve_market_1.resolvemarket);
addJsonEndpointRoute('/unsubscribe', unsubscribe_1.unsubscribe);
addJsonEndpointRoute('/createcheckoutsession', stripe_1.createcheckoutsession);
addJsonEndpointRoute('/getcurrentuser', get_current_user_1.getcurrentuser);
addJsonEndpointRoute('/savetwitchcredentials', save_twitch_credentials_1.savetwitchcredentials);
addEndpointRoute('/stripewebhook', stripe_1.stripewebhook, express.raw());
addEndpointRoute('/createpost', create_post_1.createpost);
addEndpointRoute('/testscheduledfunction', test_scheduled_function_1.testscheduledfunction);
addJsonEndpointRoute('/validateIap', validate_iap_1.validateiap);
addJsonEndpointRoute('/markallnotifications', mark_all_notifications_1.markallnotifications);
addJsonEndpointRoute('/claimdestinysub', claim_destiny_sub_1.claimdestinysub);
addJsonEndpointRoute('/updatememberrole', update_group_member_role_1.updatememberrole);
addJsonEndpointRoute('/addcontracttogroup', add_contract_to_group_1.addcontracttogroup);
addJsonEndpointRoute('/removecontractfromgroup', remove_contract_from_group_1.removecontractfromgroup);
app.listen(PORT);
console.log(`Serving functions on port ${PORT}.`);
//# sourceMappingURL=serve.js.map